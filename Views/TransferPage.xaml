<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="AcuPuntos.Views.TransferPage"
             Title="{Binding Title}"
             BackgroundColor="#F5F5F5">

    <ScrollView>
        <VerticalStackLayout Spacing="20" Padding="20">
            
            <!-- Card de saldo actual -->
            <Frame Style="{StaticResource CardFrame}"
                   BackgroundColor="#2ECC71"
                   Padding="20">
                <Grid ColumnDefinitions="*,Auto">
                    <VerticalStackLayout>
                        <Label Text="Tu saldo actual"
                               TextColor="White"
                               FontSize="14"
                               Opacity="0.9"/>
                        <Label Text="{Binding CurrentUser.Points, StringFormat='{0:N0} puntos'}"
                               TextColor="White"
                               FontSize="32"
                               FontAttributes="Bold"/>
                    </VerticalStackLayout>
                    <Label Grid.Column="1"
                           Text="ðŸ’°"
                           FontSize="50"
                           VerticalOptions="Center"/>
                </Grid>
            </Frame>

            <!-- Formulario de transferencia -->
            <Frame Style="{StaticResource CardFrame}"
                   Padding="20">
                <VerticalStackLayout Spacing="20">
                    
                    <Label Text="Transferir Puntos"
                           FontSize="22"
                           FontAttributes="Bold"
                           TextColor="#333333"/>
                    
                    <!-- Campo de bÃºsqueda -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Buscar usuario"
                               FontSize="14"
                               TextColor="#666666"/>
                        <SearchBar Placeholder="Nombre o email..."
                                   Text="{Binding SearchText}"
                                   BackgroundColor="#F5F5F5"
                                   PlaceholderColor="#999999"/>
                    </VerticalStackLayout>

                    <!-- Lista de usuarios -->
                    <Frame BackgroundColor="#F5F5F5"
                           Padding="5"
                           HeightRequest="200"
                           CornerRadius="10"
                           BorderColor="#E0E0E0">
                        <ScrollView>
                            <CollectionView ItemsSource="{Binding FilteredUsers}"
                                          SelectionMode="None">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Frame Margin="5"
                                               Padding="15"
                                               BackgroundColor="White"
                                               CornerRadius="10"
                                               BorderColor="{Binding IsSelected, Converter={StaticResource SelectedColorConverter}}">
                                            <Frame.GestureRecognizers>
                                                <TapGestureRecognizer 
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SelectUserCommand}"
                                                    CommandParameter="{Binding .}"/>
                                            </Frame.GestureRecognizers>
                                            <Grid ColumnDefinitions="Auto,*">
                                                <Label Text="ðŸ‘¤"
                                                       FontSize="30"
                                                       VerticalOptions="Center"/>
                                                <VerticalStackLayout Grid.Column="1"
                                                                   Margin="10,0,0,0">
                                                    <Label Text="{Binding DisplayName}"
                                                           FontSize="16"
                                                           FontAttributes="Bold"
                                                           TextColor="#333333"/>
                                                    <Label Text="{Binding Email}"
                                                           FontSize="12"
                                                           TextColor="#666666"/>
                                                </VerticalStackLayout>
                                            </Grid>
                                        </Frame>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </ScrollView>
                    </Frame>

                    <!-- Usuario seleccionado -->
                    <Frame IsVisible="{Binding SelectedUser, Converter={StaticResource NullToBoolConverter}}"
                           BackgroundColor="#E8F8F5"
                           Padding="15"
                           CornerRadius="10"
                           BorderColor="#2ECC71">
                        <Grid ColumnDefinitions="Auto,*,Auto">
                            <Label Text="âœ…"
                                   FontSize="25"
                                   VerticalOptions="Center"/>
                            <VerticalStackLayout Grid.Column="1"
                                               Margin="10,0">
                                <Label Text="Enviar a:"
                                       FontSize="12"
                                       TextColor="#666666"/>
                                <Label Text="{Binding SelectedUser.DisplayName}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="#2ECC71"/>
                            </VerticalStackLayout>
                            <Button Grid.Column="2"
                                    Text="âœ•"
                                    BackgroundColor="Transparent"
                                    TextColor="#E74C3C"
                                    FontSize="20"
                                    Command="{Binding SelectUserCommand}"
                                    CommandParameter="{x:Null}"
                                    WidthRequest="40"
                                    HeightRequest="40"/>
                        </Grid>
                    </Frame>

                    <!-- Cantidad de puntos -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Cantidad de puntos"
                               FontSize="14"
                               TextColor="#666666"/>
                        <Entry Placeholder="Ingresa la cantidad..."
                               Text="{Binding PointsToTransfer}"
                               Keyboard="Numeric"
                               BackgroundColor="#F5F5F5"/>
                    </VerticalStackLayout>

                    <!-- DescripciÃ³n (opcional) -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Mensaje (opcional)"
                               FontSize="14"
                               TextColor="#666666"/>
                        <Editor Placeholder="AÃ±ade un mensaje..."
                                Text="{Binding Description}"
                                BackgroundColor="#F5F5F5"
                                HeightRequest="80"/>
                    </VerticalStackLayout>

                    <!-- Mensaje de error -->
                    <Label Text="{Binding ErrorMessage}"
                           TextColor="#E74C3C"
                           FontSize="14"
                           IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBoolConverter}}"
                           HorizontalOptions="Center"/>

                    <!-- BotÃ³n de transferir -->
                    <Button Text="Transferir Puntos"
                            Command="{Binding TransferPointsCommand}"
                            IsEnabled="{Binding CanTransfer}"
                            BackgroundColor="#2ECC71"
                            TextColor="White"
                            FontAttributes="Bold"
                            HeightRequest="50"
                            CornerRadius="25">
                        <Button.Triggers>
                            <DataTrigger TargetType="Button"
                                       Binding="{Binding CanTransfer}"
                                       Value="False">
                                <Setter Property="BackgroundColor" Value="#95A5A6"/>
                            </DataTrigger>
                        </Button.Triggers>
                    </Button>

                </VerticalStackLayout>
            </Frame>

            <!-- InformaciÃ³n adicional -->
            <Frame Style="{StaticResource CardFrame}"
                   BackgroundColor="#FFF9E6"
                   Padding="15">
                <Grid ColumnDefinitions="Auto,*">
                    <Label Text="ðŸ’¡"
                           FontSize="25"/>
                    <VerticalStackLayout Grid.Column="1"
                                       Margin="10,0,0,0">
                        <Label Text="InformaciÃ³n"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#F39C12"/>
                        <Label Text="Las transferencias son instantÃ¡neas y no se pueden revertir. AsegÃºrate de seleccionar el usuario correcto."
                               FontSize="12"
                               TextColor="#666666"/>
                    </VerticalStackLayout>
                </Grid>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
