<?xml version="1.0" encoding="utf-8" ?>
<views:BasePage
    BackgroundColor="#F5F5F5"
    Shell.NavBarIsVisible="True"
    Shell.TabBarIsVisible="False"
    Title="{Binding Title}"
    x:Class="AcuPuntos.Views.HistoryPage"
    x:DataType="viewmodels:HistoryViewModel"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:models="clr-namespace:AcuPuntos.Models"
    xmlns:viewmodels="clr-namespace:AcuPuntos.ViewModels"
    xmlns:views="clr-namespace:AcuPuntos.Views"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!--  EstadÃ­sticas  -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <!--  Puntos ganados  -->
                <Border
                    BackgroundColor="#2ECC71"
                    Grid.Column="0"
                    Padding="15"
                    Style="{StaticResource CardFrame}">
                    <VerticalStackLayout Spacing="5">
                        <Label
                            FontSize="30"
                            HorizontalOptions="Center"
                            Text="ðŸ“ˆ" />
                        <Label
                            FontSize="12"
                            HorizontalOptions="Center"
                            Text="Ganados"
                            TextColor="White" />
                        <Label
                            FontAttributes="Bold"
                            FontSize="22"
                            HorizontalOptions="Center"
                            Text="{Binding TotalPointsEarned, StringFormat='{0:N0}'}"
                            TextColor="White" />
                    </VerticalStackLayout>
                </Border>

                <!--  Puntos gastados  -->
                <Border
                    BackgroundColor="#E74C3C"
                    Grid.Column="1"
                    Padding="15"
                    Style="{StaticResource CardFrame}">
                    <VerticalStackLayout Spacing="5">
                        <Label
                            FontSize="30"
                            HorizontalOptions="Center"
                            Text="ðŸ“‰" />
                        <Label
                            FontSize="12"
                            HorizontalOptions="Center"
                            Text="Gastados"
                            TextColor="White" />
                        <Label
                            FontAttributes="Bold"
                            FontSize="22"
                            HorizontalOptions="Center"
                            Text="{Binding TotalPointsSpent, StringFormat='{0:N0}'}"
                            TextColor="White" />
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!--  Filtros  -->
            <Border Padding="15" Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="10">
                    <SearchBar
                        BackgroundColor="#F5F5F5"
                        Placeholder="Buscar en historial..."
                        PlaceholderColor="#999999"
                        Text="{Binding SearchText}" />

                    <HorizontalStackLayout Spacing="10">
                        <Label
                            FontSize="14"
                            Text="Filtrar:"
                            TextColor="#666666"
                            VerticalOptions="Center" />
                        <Picker
                            BackgroundColor="#F5F5F5"
                            HorizontalOptions="FillAndExpand"
                            ItemsSource="{Binding Filters}"
                            SelectedItem="{Binding SelectedFilter}" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!--  Lista de transacciones  -->
            <Label
                FontAttributes="Bold"
                FontSize="16"
                Text="{Binding TotalTransactions, StringFormat='Total: {0} transacciones'}"
                TextColor="#666666" />

            <CollectionView ItemsSource="{Binding FilteredTransactions}" SelectionMode="None">
                <CollectionView.EmptyView>
                    <Border Padding="40" Style="{StaticResource CardFrame}">
                        <VerticalStackLayout Spacing="10">
                            <Label
                                FontSize="50"
                                HorizontalOptions="Center"
                                Text="ðŸ“Š" />
                            <Label
                                FontSize="16"
                                HorizontalOptions="Center"
                                Text="No hay transacciones"
                                TextColor="#666666" />
                        </VerticalStackLayout>
                    </Border>
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Transaction">
                        <Border
                            Margin="0,0,0,10"
                            Padding="15"
                            Style="{StaticResource ListItemCard}">
                            <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto,Auto">

                                <!--  Icono segÃºn tipo  -->
                                <Label
                                    FontSize="40"
                                    Grid.Row="0"
                                    Grid.RowSpan="2"
                                    Text="{Binding Type, Converter={StaticResource TransactionIconConverter}}"
                                    VerticalOptions="Center" />

                                <!--  DescripciÃ³n  -->
                                <VerticalStackLayout
                                    Grid.Column="1"
                                    Grid.Row="0"
                                    Margin="15,0,0,0">
                                    <Label
                                        FontAttributes="Bold"
                                        FontSize="16"
                                        LineBreakMode="TailTruncation"
                                        MaxLines="2"
                                        Text="{Binding Description}"
                                        TextColor="#333333" />
                                    <Label
                                        FontSize="12"
                                        Text="{Binding CreatedAt, StringFormat='{0:dd/MM/yyyy HH:mm}'}"
                                        TextColor="{StaticResource Gray400}" />
                                </VerticalStackLayout>

                                <!--  Monto  -->
                                <VerticalStackLayout
                                    Grid.Column="2"
                                    Grid.Row="0"
                                    HorizontalOptions="End">
                                    <Label
                                        FontAttributes="Bold"
                                        FontSize="20"
                                        HorizontalOptions="End"
                                        Text="{Binding Amount, StringFormat='{0:+#,0;-#,0;0}'}"
                                        TextColor="{Binding Type, Converter={StaticResource TransactionColorConverter}}" />
                                    <Label
                                        FontSize="12"
                                        HorizontalOptions="End"
                                        Text="puntos"
                                        TextColor="{StaticResource Gray400}" />
                                </VerticalStackLayout>

                                <!--  Tipo de transacciÃ³n  -->
                                <Border
                                    BackgroundColor="{Binding Type, Converter={StaticResource TransactionColorConverter}}"
                                    Grid.ColumnSpan="3"
                                    Grid.Row="2"
                                    HorizontalOptions="Start"
                                    Margin="0,10,0,0"
                                    Padding="8,4"
                                    StrokeShape="RoundRectangle 10">
                                    <Label
                                        FontAttributes="Bold"
                                        FontSize="12"
                                        Text="{Binding Type, Converter={StaticResource TransactionTypeConverter}}"
                                        TextColor="White" />
                                </Border>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</views:BasePage>
