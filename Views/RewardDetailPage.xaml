<?xml version="1.0" encoding="utf-8" ?>
<views:BasePage
    BackgroundColor="{AppThemeBinding Light={StaticResource Light},
                                      Dark={StaticResource Gray950}}"
    Shell.NavBarIsVisible="True"
    Shell.TabBarIsVisible="False"
    Title="{Binding Title}"
    x:Class="AcuPuntos.Views.RewardDetailPage"
    x:DataType="viewmodels:RewardDetailViewModel"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:viewmodels="clr-namespace:AcuPuntos.ViewModels"
    xmlns:views="clr-namespace:AcuPuntos.Views"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!--  Icono grande  -->
            <Label
                FontSize="100"
                HorizontalOptions="Center"
                Text="{Binding Reward.Icon, FallbackValue='ðŸŽ'}" />

            <!--  InformaciÃ³n principal  -->
            <Border Padding="20" Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="15">

                    <Label
                        FontAttributes="Bold"
                        FontSize="24"
                        HorizontalOptions="Center"
                        HorizontalTextAlignment="Center"
                        Text="{Binding Reward.Name}"
                        TextColor="{AppThemeBinding Light={StaticResource Dark},
                                                    Dark={StaticResource White}}" />

                    <!--  CategorÃ­a  -->
                    <Border
                        BackgroundColor="LightBlue"
                        HorizontalOptions="Center"
                        Padding="10,5"
                        StrokeShape="RoundRectangle 15">
                        <Label
                            FontAttributes="Bold"
                            FontSize="14"
                            Text="{Binding Reward.Category}"
                            TextColor="White" />
                    </Border>

                    <!--  Costo  -->
                    <Border
                        BackgroundColor="{StaticResource Primary}"
                        HorizontalOptions="Center"
                        Padding="15,10"
                        StrokeShape="RoundRectangle 20">
                        <HorizontalStackLayout Spacing="5">
                            <Label
                                FontSize="20"
                                Text="ðŸ’°"
                                VerticalOptions="Center" />
                            <Label
                                FontAttributes="Bold"
                                FontSize="22"
                                Text="{Binding Reward.PointsCost, StringFormat='{0:N0} puntos'}"
                                TextColor="White"
                                VerticalOptions="Center" />
                        </HorizontalStackLayout>
                    </Border>

                    <!--  DescripciÃ³n  -->
                    <BoxView
                        Color="#E0E0E0"
                        HeightRequest="1"
                        Margin="0,10" />

                    <Label
                        FontAttributes="Bold"
                        FontSize="16"
                        Text="DescripciÃ³n"
                        TextColor="{AppThemeBinding Light={StaticResource Gray},
                                                    Dark={StaticResource Gray400}}" />

                    <Label
                        FontSize="15"
                        LineBreakMode="WordWrap"
                        Text="{Binding Reward.Description}"
                        TextColor="{AppThemeBinding Light={StaticResource Dark},
                                                    Dark={StaticResource White}}" />

                    <!--  InformaciÃ³n adicional  -->
                    <BoxView
                        Color="#E0E0E0"
                        HeightRequest="1"
                        Margin="0,10" />

                    <!--  Fecha de expiraciÃ³n  -->
                    <HorizontalStackLayout IsVisible="{Binding Reward.ExpiryDate, Converter={StaticResource NullToBoolConverter}}" Spacing="10">
                        <Label
                            FontSize="20"
                            Text="â°"
                            VerticalOptions="Center" />
                        <VerticalStackLayout>
                            <Label
                                FontSize="12"
                                Text="VÃ¡lido hasta:"
                                TextColor="{AppThemeBinding Light={StaticResource Gray},
                                                            Dark={StaticResource Gray400}}" />
                            <Label
                                FontAttributes="Bold"
                                FontSize="14"
                                Text="{Binding Reward.ExpiryDate, StringFormat='{0:dd/MM/yyyy}'}"
                                TextColor="{AppThemeBinding Light={StaticResource Dark},
                                                            Dark={StaticResource White}}" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>

                    <!--  LÃ­mite de canjes  -->
                    <HorizontalStackLayout IsVisible="{Binding Reward.MaxRedemptionsPerUser, Converter={StaticResource NullToBoolConverter}}" Spacing="10">
                        <Label
                            FontSize="20"
                            Text="ðŸŽ¯"
                            VerticalOptions="Center" />
                        <VerticalStackLayout>
                            <Label
                                FontSize="12"
                                Text="LÃ­mite por usuario:"
                                TextColor="{AppThemeBinding Light={StaticResource Gray},
                                                            Dark={StaticResource Gray400}}" />
                            <Label
                                FontAttributes="Bold"
                                FontSize="14"
                                Text="{Binding Reward.MaxRedemptionsPerUser, StringFormat='{0} canjes'}"
                                TextColor="{AppThemeBinding Light={StaticResource Dark},
                                                            Dark={StaticResource White}}" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>

                </VerticalStackLayout>
            </Border>

            <!--  Estado del usuario  -->
            <Border
                BackgroundColor="{AppThemeBinding Light={StaticResource Gray100},
                                                  Dark={StaticResource Gray900}}"
                Padding="20"
                Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="10">
                    <HorizontalStackLayout Spacing="10">
                        <Border
                            BackgroundColor="{AppThemeBinding Light={StaticResource Gray200},
                                                              Dark={StaticResource Gray800}}"
                            HeightRequest="40"
                            StrokeShape="RoundRectangle 20"
                            StrokeThickness="2"
                            VerticalOptions="Center"
                            WidthRequest="40">
                            <Image Aspect="AspectFill" Source="{Binding CurrentUser.PhotoUrl, TargetNullValue='user_placeholder.svg', FallbackValue='user_placeholder.svg'}" />
                        </Border>
                        <VerticalStackLayout>
                            <Label
                                FontSize="14"
                                Text="Tus puntos:"
                                TextColor="{AppThemeBinding Light={StaticResource Gray},
                                                            Dark={StaticResource Gray400}}" />
                            <Label
                                FontAttributes="Bold"
                                FontSize="18"
                                Text="{Binding CurrentUser.Points, StringFormat='{0:N0} puntos'}"
                                TextColor="{StaticResource Primary}" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>

                    <Label
                        FontSize="14"
                        HorizontalTextAlignment="Center"
                        Margin="0,10,0,0"
                        Text="{Binding StatusMessage}"
                        TextColor="{AppThemeBinding Light={StaticResource Gray},
                                                    Dark={StaticResource Gray400}}" />
                </VerticalStackLayout>
            </Border>

            <!--  BotÃ³n de canje  -->
            <Button
                BackgroundColor="{StaticResource Primary}"
                Command="{Binding RedeemRewardCommand}"
                CornerRadius="27"
                FontAttributes="Bold"
                FontSize="18"
                HeightRequest="55"
                IsEnabled="{Binding CanRedeem}"
                Margin="0,10,0,20"
                Text="Canjear Recompensa"
                TextColor="White">
                <Button.Triggers>
                    <DataTrigger
                        Binding="{Binding CanRedeem}"
                        TargetType="Button"
                        Value="False">
                        <Setter Property="BackgroundColor" Value="{StaticResource Gray200}" />
                        <Setter Property="TextColor" Value="{StaticResource Gray400}" />
                        <Setter Property="Text" Value="No disponible" />
                    </DataTrigger>
                </Button.Triggers>
            </Button>

        </VerticalStackLayout>
    </ScrollView>
</views:BasePage>
