<?xml version="1.0" encoding="utf-8" ?>
<views:BasePage
    BackgroundColor="#F5F5F5"
    Shell.NavBarIsVisible="True"
    Shell.TabBarIsVisible="False"
    Title="{Binding Title}"
    x:Class="AcuPuntos.Views.AdminPage"
    x:DataType="viewmodels:AdminViewModel"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:models="clr-namespace:AcuPuntos.Models"
    xmlns:viewmodels="clr-namespace:AcuPuntos.ViewModels"
    xmlns:views="clr-namespace:AcuPuntos.Views"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!--  EstadÃ­sticas rÃ¡pidas  -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <!--  Total usuarios  -->
                <Border
                    BackgroundColor="#3498DB"
                    Grid.Column="0"
                    Padding="15"
                    Style="{StaticResource CardFrame}">
                    <VerticalStackLayout Spacing="5">
                        <Label
                            FontSize="30"
                            HorizontalOptions="Center"
                            Text="ðŸ‘¥" />
                        <Label
                            FontSize="12"
                            HorizontalOptions="Center"
                            Text="Usuarios"
                            TextColor="White" />
                        <Label
                            FontAttributes="Bold"
                            FontSize="26"
                            HorizontalOptions="Center"
                            Text="{Binding TotalUsers}"
                            TextColor="White" />
                    </VerticalStackLayout>
                </Border>

                <!--  Canjes pendientes  -->
                <Border
                    BackgroundColor="#F39C12"
                    Grid.Column="1"
                    Padding="15"
                    Style="{StaticResource CardFrame}">
                    <VerticalStackLayout Spacing="5">
                        <Label
                            FontSize="30"
                            HorizontalOptions="Center"
                            Text="â³" />
                        <Label
                            FontSize="12"
                            HorizontalOptions="Center"
                            Text="Pendientes"
                            TextColor="White" />
                        <Label
                            FontAttributes="Bold"
                            FontSize="26"
                            HorizontalOptions="Center"
                            Text="{Binding PendingRedemptionsCount}"
                            TextColor="White" />
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!--  Canjes pendientes  -->
            <Label
                FontAttributes="Bold"
                FontSize="20"
                Text="â³ Canjes Pendientes"
                TextColor="#333333" />

            <CollectionView
                HeightRequest="250"
                ItemsSource="{Binding PendingRedemptions}"
                SelectionMode="None">
                <CollectionView.EmptyView>
                    <Border Padding="30" Style="{StaticResource CardFrame}">
                        <VerticalStackLayout Spacing="10">
                            <Label
                                FontSize="40"
                                HorizontalOptions="Center"
                                Text="âœ…" />
                            <Label
                                FontSize="14"
                                HorizontalOptions="Center"
                                Text="No hay canjes pendientes"
                                TextColor="#666666" />
                        </VerticalStackLayout>
                    </Border>
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Redemption">
                        <Border
                            Margin="0,0,0,10"
                            Padding="15"
                            Style="{StaticResource ListItemCard}">
                            <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto,Auto">

                                <Label
                                    FontSize="40"
                                    Grid.Row="0"
                                    Grid.RowSpan="2"
                                    Text="ðŸŽ"
                                    VerticalOptions="Center" />

                                <VerticalStackLayout
                                    Grid.Column="1"
                                    Grid.Row="0"
                                    Margin="15,0,0,0">
                                    <Label
                                        FontAttributes="Bold"
                                        FontSize="16"
                                        Text="{Binding Reward.Name}"
                                        TextColor="#333333" />
                                    <Label
                                        FontSize="14"
                                        Text="{Binding User.DisplayName}"
                                        TextColor="#666666" />
                                    <Label
                                        FontSize="12"
                                        Text="{Binding RedeemedAt, StringFormat='Canjeado: {0:dd/MM/yyyy HH:mm}'}"
                                        TextColor="#999999" />
                                </VerticalStackLayout>

                                <Label
                                    FontAttributes="Bold"
                                    FontSize="16"
                                    Grid.Column="2"
                                    Grid.Row="0"
                                    Text="{Binding PointsUsed, StringFormat='{0:N0} pts'}"
                                    TextColor="#F39C12"
                                    VerticalOptions="Start" />

                                <HorizontalStackLayout
                                    Grid.ColumnSpan="3"
                                    Grid.Row="2"
                                    Margin="0,10,0,0"
                                    Spacing="10">
                                    <Button
                                        BackgroundColor="#2ECC71"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ApproveRedemptionCommand}"
                                        CommandParameter="{Binding .}"
                                        CornerRadius="17"
                                        FontSize="12"
                                        HeightRequest="35"
                                        HorizontalOptions="FillAndExpand"
                                        Text="âœ… Aprobar"
                                        TextColor="White" />
                                    <Button
                                        BackgroundColor="#E74C3C"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.RejectRedemptionCommand}"
                                        CommandParameter="{Binding .}"
                                        CornerRadius="17"
                                        FontSize="12"
                                        HeightRequest="35"
                                        HorizontalOptions="FillAndExpand"
                                        Text="âŒ Rechazar"
                                        TextColor="White" />
                                </HorizontalStackLayout>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!--  GestiÃ³n de usuarios  -->
            <Label
                FontAttributes="Bold"
                FontSize="20"
                Margin="0,20,0,0"
                Text="ðŸ‘¥ GestiÃ³n de Usuarios"
                TextColor="#333333" />

            <SearchBar
                BackgroundColor="White"
                Placeholder="Buscar usuarios..."
                PlaceholderColor="#999999"
                Text="{Binding SearchText}" />

            <CollectionView ItemsSource="{Binding Users}" SelectionMode="None">
                <CollectionView.EmptyView>
                    <Border Padding="30" Style="{StaticResource CardFrame}">
                        <Label
                            FontSize="14"
                            HorizontalOptions="Center"
                            Text="No hay usuarios"
                            TextColor="#666666" />
                    </Border>
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:User">
                        <Border
                            Margin="0,0,0,10"
                            Padding="15"
                            Style="{StaticResource ListItemCard}">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ViewUserDetailCommand}" CommandParameter="{Binding .}" />
                            </Border.GestureRecognizers>
                            <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto">

                                <Border
                                    BackgroundColor="#E0E0E0"
                                    Grid.Row="0"
                                    Grid.RowSpan="2"
                                    HeightRequest="55"
                                    StrokeShape="RoundRectangle 28"
                                    StrokeThickness="2"
                                    VerticalOptions="Center"
                                    WidthRequest="55">
                                    <Image
                                        Aspect="AspectFill"
                                        Source="{Binding PhotoUrl, TargetNullValue='user_placeholder.svg', FallbackValue='user_placeholder.svg'}" />
                                </Border>

                                <VerticalStackLayout
                                    Grid.Column="1"
                                    Grid.Row="0"
                                    Margin="15,0,0,0">
                                    <Label
                                        FontAttributes="Bold"
                                        FontSize="16"
                                        Text="{Binding DisplayName}"
                                        TextColor="#333333" />
                                    <Label
                                        FontSize="12"
                                        Text="{Binding Email}"
                                        TextColor="#666666" />
                                </VerticalStackLayout>

                                <VerticalStackLayout Grid.Column="2" Grid.Row="0">
                                    <Label
                                        FontAttributes="Bold"
                                        FontSize="20"
                                        HorizontalOptions="End"
                                        Text="{Binding Points, StringFormat='{0:N0}'}"
                                        TextColor="#2ECC71" />
                                    <Label
                                        FontSize="12"
                                        HorizontalOptions="End"
                                        Text="puntos"
                                        TextColor="#999999" />
                                </VerticalStackLayout>

                                <Button
                                    BackgroundColor="#3498DB"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AssignPointsCommand}"
                                    CommandParameter="{Binding .}"
                                    CornerRadius="17"
                                    FontSize="12"
                                    Grid.Column="1"
                                    Grid.ColumnSpan="2"
                                    Grid.Row="1"
                                    HeightRequest="35"
                                    Margin="15,10,0,0"
                                    Text="ðŸ’° Asignar Puntos"
                                    TextColor="White" />

                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!--  BotÃ³n de inicializar badges  -->
            <!--  <Button Text="ðŸŽ–ï¸ Inicializar Badges del Sistema"  -->
            <!--  Command="{Binding InitializeBadgesCommand}"  -->
            <!--  BackgroundColor="#9B59B6"  -->
            <!--  TextColor="White"  -->
            <!--  FontAttributes="Bold"  -->
            <!--  HeightRequest="50"  -->
            <!--  CornerRadius="25"  -->
            <!--  Margin="0,10,0,0"/>  -->

        </VerticalStackLayout>
    </ScrollView>
</views:BasePage>
